<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GetEventLogAlarm - ALSmart Design Docs</title>
    <meta name="description"
        content="Comprehensive documentation for Danfoss ALSmart Design function blocks, libraries, and components.">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body data-basepath="../">
    <div class="wrapper">
        <aside class="sidebar">
            <div class="logo-area">
                <h2>ALSmart Design</h2>
                <p>Documentation Library</p>
            </div>
            <div class="search-box">
                <input type="text" id="sidebar-search" placeholder="Search FBDs...">
                <div id="search-results" class="search-results-container"></div>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="../index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li class="category-header">Categories</li>
                    <li><a href="../categories/communication-modbus.html"><i class="fas fa-folder"></i> Communication (Modbus) <span class="badge">911</span></a></li>
                    <li><a href="../categories/file-data-management.html"><i class="fas fa-folder"></i> File & Data Management <span class="badge">482</span></a></li>
                    <li><a href="../categories/hmi-display.html"><i class="fas fa-folder"></i> HMI & Display <span class="badge">399</span></a></li>
                    <li><a href="../categories/inputs-sensors.html"><i class="fas fa-folder"></i> Inputs & Sensors <span class="badge">176</span></a></li>
                    <li><a href="../categories/alarms-safety.html"><i class="fas fa-folder"></i> Alarms & Safety <span class="badge">154</span></a></li>
                    <li><a href="../categories/i-o-management.html"><i class="fas fa-folder"></i> I/O Management <span class="badge">127</span></a></li>
                    <li><a href="../categories/communication-mqtt.html"><i class="fas fa-folder"></i> Communication (MQTT) <span class="badge">77</span></a></li>
                    <li><a href="../categories/string-handling.html"><i class="fas fa-folder"></i> String Handling <span class="badge">51</span></a></li>
                    <li><a href="../categories/superheat-control.html"><i class="fas fa-folder"></i> Superheat Control <span class="badge">37</span></a></li>
                    <li><a href="../categories/control-logic.html"><i class="fas fa-folder"></i> Control Logic <span class="badge">32</span></a></li>
                    <li><a href="../categories/compressor-control.html"><i class="fas fa-folder"></i> Compressor Control <span class="badge">30</span></a></li>
                    <li><a href="../categories/valve-control.html"><i class="fas fa-folder"></i> Valve Control <span class="badge">25</span></a></li>
                    <li><a href="../categories/communication.html"><i class="fas fa-folder"></i> Communication <span class="badge">18</span></a></li>
                    <li><a href="../categories/communication-can.html"><i class="fas fa-folder"></i> Communication (CAN) <span class="badge">14</span></a></li>
                    <li><a href="../categories/bit-management.html"><i class="fas fa-folder"></i> Bit Management <span class="badge">14</span></a></li>
                    <li><a href="../categories/communication-bacnet.html"><i class="fas fa-folder"></i> Communication (BACnet) <span class="badge">12</span></a></li>
                    <li><a href="../categories/control-loops-pid.html"><i class="fas fa-folder"></i> Control Loops (PID) <span class="badge">9</span></a></li>
                    <li><a href="../categories/math-logic.html"><i class="fas fa-folder"></i> Math & Logic <span class="badge">9</span></a></li>
                    <li><a href="../categories/scheduling.html"><i class="fas fa-folder"></i> Scheduling <span class="badge">9</span></a></li>
                    <li><a href="../categories/temperature.html"><i class="fas fa-folder"></i> Temperature <span class="badge">9</span></a></li>
                    <li><a href="../categories/motor-control.html"><i class="fas fa-folder"></i> Motor Control <span class="badge">8</span></a></li>
                    <li><a href="../categories/timers-counters.html"><i class="fas fa-folder"></i> Timers & Counters <span class="badge">8</span></a></li>
                    <li><a href="../categories/thermodynamics.html"><i class="fas fa-folder"></i> Thermodynamics <span class="badge">6</span></a></li>
                    <li><a href="../categories/pressure.html"><i class="fas fa-folder"></i> Pressure <span class="badge">4</span></a></li>
                    <li><a href="../categories/unit-conversion.html"><i class="fas fa-folder"></i> Unit Conversion <span class="badge">4</span></a></li>
                    <li><a href="../categories/hvac-general.html"><i class="fas fa-folder"></i> HVAC General <span class="badge">3</span></a></li>
                    <li><a href="../categories/expansion-valve.html"><i class="fas fa-folder"></i> Expansion Valve <span class="badge">2</span></a></li>
                    <li><a href="../categories/pump-control.html"><i class="fas fa-folder"></i> Pump Control <span class="badge">2</span></a></li>
                    <li><a href="../categories/defrost-logic.html"><i class="fas fa-folder"></i> Defrost Logic <span class="badge">2</span></a></li>
                    <li><a href="../categories/external-devices.html"><i class="fas fa-folder"></i> External Devices <span class="badge">1</span></a></li>
                    <li><a href="../categories/system-utilities.html"><i class="fas fa-folder"></i> System Utilities <span class="badge">1</span></a></li>
                    <li class="category-header">Reference</li>
                    <li><a href="../taxonomy.html"><i class="fas fa-sitemap"></i> Taxonomy</a></li>
                    <li><a href="../beginners_guide.html"><i class="fas fa-graduation-cap"></i> Beginner's
                            Guide</a></li>
                </ul>
            </nav>
            <div class="footer-info">
                <p>Generated: 2026-02-17 05:08</p>
                <p><a href="../sitemap.html" class="footer-link">Sitemap</a></p>
            </div>
        </aside>

        <main class="content">
            <header class="top-bar">
                <div class="breadcrumbs">
                    
<a href="../index.html">Home</a> &gt;
<a href="../categories/alarms-safety.html">Alarms & Safety</a> &gt;
<span>GetEventLogAlarm</span>

                </div>
                <div class="actions">
                    <button id="theme-btn" title="Toggle Dark Mode"><i class="fas fa-moon"></i></button>
                </div>
            </header>

            <div class="page-content">
                
<div class="fbd-detail">
    <div class="fbd-header">
        <h1>GetEventLogAlarm</h1>
        <div class="badges">
            <span class="badge category">Alarms & Safety</span>
            <span class="badge complexity intermediate">Intermediate</span>
            <span class="badge type">FunctionBlock</span>
            <span class="badge version">v1.0.0</span>
        </div>
    </div>

    

    <div class="section description">
        <h2><i class="fas fa-info-circle"></i> Description</h2>
        <div class="content-box">
            <p>Extracts a single alarm event from the Event Log file.

NOTES: This function block must be used in the Backgroud task</p>
        </div>
    </div>

    

    <div class="grid-2-col">
        <div class="section inputs">
            <h2><i class="fas fa-sign-in-alt"></i> Inputs (2)</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Init</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr>
                            <td class="code-font">xFirstNext</td>
                            <td class="type-font">BOOL</td>
                            <td class="code-font"></td>
                            <td>BOOL, range [FALSE, TRUE]. TRUE: return the newest item  FALSE: return the previus one</td>
                        </tr>
                        
                        <tr>
                            <td class="code-font">eventLogData</td>
                            <td class="type-font">TEventLog^</td>
                            <td class="code-font"></td>
                            <td>TEventLog. Returns the data associated with the alarm</td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section outputs">
            <h2><i class="fas fa-sign-out-alt"></i> Outputs (5)</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        <tr>
                            <td class="code-font">xError</td>
                            <td class="type-font">BOOL</td>
                            <td>BOOL, range [FALSE, TRUE]: TRUE: error on loading the event</td>
                        </tr>
                        
                        <tr>
                            <td class="code-font">xFound</td>
                            <td class="type-font">BOOL</td>
                            <td>BOOL, range [FALSE, TRUE]: TRUE: an alarm event was found</td>
                        </tr>
                        
                        <tr>
                            <td class="code-font">xLogEmpty</td>
                            <td class="type-font">BOOL</td>
                            <td>BOOL, range [FALSE, TRUE]: TRUE: the event log file is empty</td>
                        </tr>
                        
                        <tr>
                            <td class="code-font">udiTime</td>
                            <td class="type-font">UDINT</td>
                            <td>UDINT, unit [s]. Absolute time when the event was logged</td>
                        </tr>
                        
                        <tr>
                            <td class="code-font">uiTimeOffset</td>
                            <td class="type-font">UINT</td>
                            <td>UINT, unit [s]. Offset time when the event was logged</td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    
    <div class="section">
        <h2><i class="fas fa-cog"></i> Local Variables (23)</h2>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <td class="code-font">fbGetEventLogItem</td>
                        <td class="type-font">GetEventLogItem</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">uiDataSize</td>
                        <td class="type-font">UINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">a_usiDataBuff</td>
                        <td class="type-font">USINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">pUINT</td>
                        <td class="type-font">@UINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">uiAux</td>
                        <td class="type-font">UINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">usiIndex</td>
                        <td class="type-font">USINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">fbMessagePack</td>
                        <td class="type-font">MessagePack</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">usiAux</td>
                        <td class="type-font">USINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">udiAux</td>
                        <td class="type-font">UDINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">usiData</td>
                        <td class="type-font">USINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">uiData</td>
                        <td class="type-font">UINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">udiData</td>
                        <td class="type-font">UDINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">uiBuffIndex</td>
                        <td class="type-font">UINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">rData</td>
                        <td class="type-font">REAL</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">a_usiTest</td>
                        <td class="type-font">USINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">xData</td>
                        <td class="type-font">BOOL</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">uliData</td>
                        <td class="type-font">ULINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">liData</td>
                        <td class="type-font">LINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">lrData</td>
                        <td class="type-font">LREAL</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">siData</td>
                        <td class="type-font">SINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">iData</td>
                        <td class="type-font">INT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">diData</td>
                        <td class="type-font">DINT</td>
                        <td></td>
                    </tr>
                    
                    <tr>
                        <td class="code-font">uiNumItems</td>
                        <td class="type-font">UINT</td>
                        <td></td>
                    </tr>
                    
                </tbody>
            </table>
        </div>
    </div>
    

    
    <div class="section source-code">
        <h2><i class="fas fa-code"></i> Source Code (ST)</h2>
        <pre><code>xFound := FALSE;
	xError := FALSE;
	
	(*	Convert the record on the eventLogData 	*)
	eventLogData^.EventType := 0;
	eventLogData^.AlarmContextVariablesNumber := 0;

	(*	Clean the arrays	*)
	FOR usiIndex := 0 TO 9 DO
		eventLogData^.AlarmContextVariablesUniqueIDs[usiIndex] := 0;
		eventLogData^.AlarmContextVariablesValues[usiIndex] := 0;
	END_FOR;
	
	(*	Scroll the event log file	*)
	WHILE ((xFound = FALSE) AND (xError = FALSE)) DO
	
		(*	Get the event log record	*)
		fbGetEventLogItem.xFirstNext := xFirstNext;
		fbGetEventLogItem.uiDataSize := 256;
		fbGetEventLogItem.pntDataBuff := ADR(a_usiDataBuff[0]);

		fbGetEventLogItem();
	
		xLogEmpty := fbGetEventLogItem.xLogEmpty;
		xError := fbGetEventLogItem.xError;

		IF (xError = TRUE) THEN
			(*	Error loading record	*)
			RETURN;
		END_IF;
		
		(*	Valid record	*)
		IF (xError = FALSE) THEN
			pUINT := ADR(a_usiDataBuff[0]);
		
			(*	Check if it is an alarm event	*)
			CASE (@pUINT) OF
			
			EventLog_EventType#AlarmStarted,	(*	Start alarm	*)
			EventLog_EventType#AlarmEnded:		(*	End alarm	*)
							
				(*	Load time and timeOffset	*)
				uiTimeOffset := fbGetEventLogItem.uiTimeOffset;
				udiTime := fbGetEventLogItem.udiTime;
				
				eventLogData^.EventType := @pUINT;

				uiBuffIndex := 3;
								
				(*	Extract the number of items		*)
//				usiAux := fbMessagePack.GetData_USINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
				usiAux := fbMessagePack.GetSizeArray(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
													(256 - uiBuffIndex),				(*	uiDataBuffSize	*)
													ADR(uiNumItems));					(*	pntData			*)

				IF (usiAux > 0) THEN				
					uiBuffIndex := uiBuffIndex + usiAux;
				ELSE
					(*	Data size wrong	*)
					xError := TRUE;
					RETURN;
				END_IF;


				(*	Extract the alarm unique ID	*)
				usiAux := fbMessagePack.GetData_UDINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
													 252,								(*	uiDataBuffSize	*)
													 ADR(udiData));						(*	pntData			*)
					
				IF (usiAux > 0) THEN				
					eventLogData^.EventUniqueID := udiData;
					uiBuffIndex := uiBuffIndex + usiAux;
				ELSE
					(*	Data size wrong	*)
					xError := TRUE;
					RETURN;
				END_IF;
	
				(*	Extract the number of context	*)
				usiAux := fbMessagePack.GetData_USINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
													 (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
													 ADR(usiData));						(*	pntData			*)
					
				IF ((usiAux > 0) AND (usiData <= 10)) THEN				
					eventLogData^.AlarmContextVariablesNumber := usiData;
					uiBuffIndex := uiBuffIndex + usiAux;
				ELSE
					(*	Data size wrong	*)
					xError := TRUE;
					RETURN;
				END_IF;
	
				usiData := (usiData * 3) + 2;
				
				(*	Check the expected value with the memorized value	*)
				IF (usiData <> TO_USINT(uiNumItems)) THEN
					(*	Data size wrong	*)
					xError := TRUE;
					RETURN;
				END_IF;
				
				(*	Context variables present	*)
				IF (usiData > 0 ) THEN
					
					(*	Extract the context variables	*)
					FOR usiIndex := 0 TO (eventLogData^.AlarmContextVariablesNumber - 1) DO
					
						(*	Extract parameter's uniqueID	*)
						usiAux := fbMessagePack.GetData_UDINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
															 (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
															 ADR(udiData));						(*	pntData			*)

						IF (usiAux > 0) THEN
							eventLogData^.AlarmContextVariablesUniqueIDs[usiIndex] := udiData;
							uiBuffIndex := uiBuffIndex + usiAux;
						ELSE
							(*	Data size wrong	*)
							xError := TRUE;
							RETURN;
						END_IF;

						(*	Extract parameter's storage type		*)
						usiAux := fbMessagePack.GetData_USINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
															 (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
															 ADR(usiData));						(*	pntData			*)

						IF (usiAux > 0) THEN
							uiBuffIndex := uiBuffIndex + usiAux;
						ELSE
							(*	data size wrong	*)
							xError := TRUE;
							RETURN;
						END_IF;

						usiAux := 0;
						
						(*	Extract parameter's value		*)
						CASE usiData OF
						
						CDFDataType_t#CDF_U1:	(*	BOOL	*)
						
							usiAux := fbMessagePack.GetData_BOOL(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																(256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																ADR(xData));						(*	pntData			*)
						
							rData := TO_REAL(xData);
							
						CDFDataType_t#CDF_U8:
						
							usiAux := fbMessagePack.GetData_USINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																 (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																 ADR(usiData));						(*	pntData			*)
						
							rData := TO_REAL(usiData);
						
						CDFDataType_t#CDF_U16:
						
							usiAux := fbMessagePack.GetData_UINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
															    (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																ADR(uiData));						(*	pntData			*)
						
							rData := TO_REAL(uiData);
						
						CDFDataType_t#CDF_U32:
						
							usiAux := fbMessagePack.GetData_UDINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																 (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																 ADR(udiData));						(*	pntData			*)
						
							rData := TO_REAL(udiData);
						
						CDFDataType_t#CDF_U64:
						
							usiAux := fbMessagePack.GetData_ULINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																 (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																 ADR(uliData));						(*	pntData			*)
						
							rData := TO_REAL(uliData);
						
						CDFDataType_t#CDF_S8:
						
							usiAux := fbMessagePack.GetData_SINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																(256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																ADR(siData));						(*	pntData			*)
						
							rData := TO_REAL(siData);
						
						CDFDataType_t#CDF_S16:
						
							usiAux := fbMessagePack.GetData_INT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
															   (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
															   ADR(iData));						(*	pntData			*)
						
							rData := TO_REAL(iData);
						
						CDFDataType_t#CDF_S32:
						
							usiAux := fbMessagePack.GetData_DINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																(256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																ADR(diData));						(*	pntData			*)
						
							rData := TO_REAL(diData);
						
						CDFDataType_t#CDF_S64:
						
							usiAux := fbMessagePack.GetData_LINT(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																(256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																ADR(liData));						(*	pntData			*)
						
							rData := TO_REAL(liData);
						
						CDFDataType_t#CDF_F32:
						
							usiAux := fbMessagePack.GetData_REAL(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
																 (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
																 ADR(rData));						(*	pntData			*)
												
						CDFDataType_t#CDF_F64:
						
						
							usiAux := fbMessagePack.GetData_LREAL(ADR(a_usiDataBuff[uiBuffIndex]), 	(*	pntDataBuff		*)
															     (256 - uiBuffIndex),				(*	uiDataBuffSize	*)
															     ADR(lrData));						(*	pntData			*)
				
							rData := TO_REAL(lrData);
							
						END_CASE;
						
						IF (usiAux > 0) THEN
							eventLogData^.AlarmContextVariablesValues[usiIndex] := rData;
							uiBuffIndex := uiBuffIndex + usiAux;
						ELSE
							(*	data size wrong	*)
							xError := TRUE;
							RETURN;
						END_IF;
						
					END_FOR;				
				
				END_IF;	
				

				xFound := TRUE;			
					
			END_CASE;		
		
		END_IF;
		
		(*	It it is the last event log item --> exit	*)
		IF ((xFound = FALSE) AND (fbGetEventLogItem.xLastRecord = TRUE)) THEN
			RETURN;
		END_IF;
				
		xFirstNext := FALSE;	(*	Set for the next one	*)
	END_WHILE;</code></pre>
    </div>
    

    <div class="section metadata">
        <h2><i class="fas fa-tags"></i> Metadata</h2>
        <div class="content-box">
            <ul><li><strong>Source File:</strong> C:\Users\PC\Desktop\danfoss\danfos\danfos\Alsmart libraries\chiller_hp_1c_ms_v25_20241028_suite_v1060002\CHILLER_HP_1C_MS\HMI\LogLibrary.plclib</li><li><strong>Version:</strong> 1.0.0</li><li><strong>Type:</strong> FunctionBlock</li><li><strong>Complexity:</strong> Intermediate</li></ul>
        </div>
    </div>
</div>

            </div>
        </main>
    </div>

    <button class="back-to-top" id="back-to-top" title="Back to top"><i class="fas fa-arrow-up"></i></button>

    <script src="../js/fuse.min.js" defer></script>
    <script src="../js/search_index.js" defer></script>
    <script src="../js/main.js" defer></script>
</body>

</html>